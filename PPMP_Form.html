<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Annual Procurement Plan - Page 1</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* Updated Body Styles */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #f3f4f6;
  color: #1f2937;
  line-height: 1.6;
  padding: 0.5rem; /* Reduced padding for more space */
  -webkit-print-color-adjust: exact;
  print-color-adjust: exact;
  /* CHANGED: Changed from hidden to auto to prevent cutting off content */
  overflow-x: auto; 
}

/* Hide scrollbars but keep functionality */
::-webkit-scrollbar {
  width: 8px; /* Give a small width so users can scroll if needed */
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 4px;
}

/* CHANGED: Container now takes full width */
.container {
  max-width: 100%; /* Changed from 1800px */
  width: 100%;     /* Forces full width */
  margin: 0;       /* Remove auto margin */
  padding: 0.5rem;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.625rem 1.25rem;
  font-size: 0.875rem;
  font-weight: 500;
  border-radius: 0.375rem;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
  white-space: nowrap;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background-color: #0b1a3a;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background-color: #1e3a8a;
  box-shadow: 0 4px 6px -1px rgba(11, 26, 58, 0.3);
}

.btn-secondary {
  background-color: #6b7280;
  color: white;
}

.btn-secondary:hover:not(:disabled) {
  background-color: #4b5563;
}

.btn-success {
  background-color: #10b981;
  color: white;
}

.btn-success:hover:not(:disabled) {
  background-color: #059669;
}

.btn-danger {
  background-color: #ef4444;
  color: white;
}

.btn-danger:hover:not(:disabled) {
  background-color: #dc2626;
}

.btn-warning {
  background-color: #f59e0b;
  color: white;
}

.btn-info {
  background-color: #06b6d4;
  color: white;
}

.btn-info:hover:not(:disabled) {
  background-color: #0891b2;
}

.controls {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.ppmp-box {
  background: white;
  border-radius: 0.5rem;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  padding: 1rem; /* Slightly reduced padding to maximize space */
  border: 2px solid #0b1a3a;
  width: 100%;
}

.form-header {
  text-align: center;
  padding: 1rem;
  background: linear-gradient(135deg, #0b1a3a 0%, #1e3a8a 100%);
  color: white;
  border-radius: 0.375rem;
  margin-bottom: 1rem;
}

.form-header h3 {
  font-size: 1.5rem;
  font-weight: 700;
  margin: 0;
  color: white;
  letter-spacing: 0.5px;
}

.header-fields {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 0.75rem;
  margin-bottom: 1rem;
  padding: 1rem;
  background-color: #f9fafb;
  border-radius: 0.375rem;
  border: 1px solid #e5e7eb;
}

.field-row {
  display: flex;
  align-items: center;
  font-size: 0.875rem;
  margin: 0.5rem 0;
}

.field-row label {
  color: #0b1a3a;
  font-weight: 600;
  display: inline-block;
  min-width: 140px;
  margin-right: 0.5rem;
  white-space: nowrap;
}

.field-row input {
  flex: 1;
  border: none;
  border-bottom: 1px dotted #9ca3af;
  padding: 0.125rem 0.5rem;
  min-width: 150px;
  font-size: 0.875rem;
  background: transparent;
  transition: all 0.2s ease;
}

.field-row input:focus {
  outline: none;
  border-bottom: 2px solid #2563eb;
  background-color: #eff6ff;
}

.table-responsive {
  overflow-x: auto; /* Allow horizontal scroll if table is too big */
  margin-bottom: 1.5rem;
  border-radius: 0.375rem;
  border: 1px solid #e5e7eb;
  width: 100%;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.75rem; /* Slightly larger for readability on full screen */
  background: white;
  table-layout: fixed; /* Keeps columns proportional */
}

th, td {
  border: 1px solid #000;
  padding: 0.4rem 0.2rem;
  text-align: center;
  vertical-align: middle;
  word-wrap: break-word;
  overflow: hidden;
  line-height: 1.2;
}

th {
  font-weight: 600;
  background: linear-gradient(135deg, #0b1a3a 0%, #1e3a8a 100%);
  color: white;
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.025em;
  line-height: 1.1;
}

.header-section {
  background: #d1d5db;
  font-weight: 700;
  text-align: center;
  color: #000;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 0.4rem 0.2rem;
  border: 1px solid #000;
}

.column-label {
  font-style: italic;
  font-size: 0.6rem;
  color: #000;
  font-weight: 600;
  text-transform: none;
}

td[contenteditable="true"] {
  cursor: text;
  transition: background-color 0.15s ease;
  min-height: 30px;
}

td[contenteditable="true"]:hover {
  background-color: #f9fafb;
}

td[contenteditable="true"]:focus {
  outline: 2px solid #2563eb;
  background-color: #eff6ff;
}

.total-row {
  font-weight: 700;
  background-color: #f9fafb;
  font-size: 0.875rem;
}

#totalBudget {
  color: #0b1a3a;
  font-size: 1rem;
  font-weight: 700;
}

.signature-section {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 2px solid #e5e7eb;
  align-items: start;
}

.signature-box {
  text-align: center;
  padding: 1.5rem;
  background-color: #f9fafb;
  border-radius: 0.375rem;
  border: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
  min-height: 180px;
}

.signature-box p {
  margin: 0.5rem 0;
  font-size: 0.875rem;
}

.signature-label {
  font-weight: 600;
  color: #6b7280;
  margin-bottom: 1rem;
}

.signature-name {
  font-weight: 700;
  text-transform: uppercase;
  color: #0b1a3a;
  font-size: 1rem;
  margin: 1rem 0 0.5rem 0;
  border-bottom: 2px solid #0b1a3a;
  padding-bottom: 0.5rem;
  display: inline-block;
  min-width: 200px;
}

.signature-title {
  color: #4b5563;
  font-size: 0.8125rem;
  margin: 0.25rem 0;
}

.watermark {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) rotate(-45deg);
  font-size: 8rem;
  color: rgba(0, 0, 0, 0.05);
  font-weight: bold;
  pointer-events: none;
  z-index: 0;
}

.content-wrapper {
  position: relative;
  z-index: 1;
}

@media print {
  body {
    background: white;
    padding: 0;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color: exact !important;
    overflow: visible;
  }
  
  .controls {
    display: none !important;
  }
  
  .container {
    padding: 0;
    max-width: 100%;
    width: 100%;
  }
  
  .ppmp-box {
    box-shadow: none;
    border: 1px solid #000;
    padding: 5px;
  }
  
  .signature-section {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 2rem !important;
    page-break-inside: avoid;
  }
  
  .signature-box {
    display: flex !important;
    flex-direction: column !important;
    border: none;
  }
  
  table, th, td {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color: exact !important;
    font-size: 8pt; /* Adjust print font size */
  }
  
  @page {
    size: A4 landscape;
    margin: 5mm;
  }
}

@media (max-width: 1200px) {
  .signature-section {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="controls no-print">
    <button class="btn btn-info" onclick="toggleFullScreen()">‚õ∂ Full Screen</button>
    <button class="btn btn-secondary" onclick="addRow()">‚ûï Add Row</button>
    <button class="btn btn-success" onclick="loadFromUPR()">üîÑ Load from UPR</button>
    <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print</button>
    <button class="btn btn-danger" onclick="clearForm()">üóëÔ∏è Clear Form</button>
  </div>

  <div class="ppmp-box">
    <div class="watermark">Page 1</div>
    
    <div class="content-wrapper">
      <div class="form-header">
        <h3>ANNUAL PROCUREMENT PLAN</h3>
        
        <div class="header-fields">
          <div class="field-row">
            <label>Fiscal Year:</label>
            <input type="text" id="fiscalYear" placeholder="e.g., 2025">
          </div>
          <div class="field-row">
            <label>End-User or Implementing Unit:</label>
            <input type="text" id="endUser" placeholder="HPN & HSG">
          </div>
        </div>
      </div>

      <div class="table-responsive">
        <table id="appTable">
          <thead>
            <tr>
              <th colspan="4" class="header-section">PROCUREMENT PROJECT DETAILS</th>
              <th colspan="4" class="header-section">PROJECTED TIMELINE (MM/YYYY)</th>
              <th colspan="2" class="header-section">FUNDING DETAILS</th>
            </tr>
            <tr>
              <th style="width: 15%;">
                General Description and<br>Objective<br>
                of the Project to be Procured<br>
                <span class="column-label">Column 1</span>
              </th>
              <th style="width: 10%;">
                Type of the Project<br>to be Procured<br>
                (whether Goods,<br>Infrastructure and<br>Consulting Services)<br>
                <span class="column-label">Column 2</span>
              </th>
              <th style="width: 10%;">
                Quantity and Size of the<br>Project<br>to be Procured<br>
                <span class="column-label">Column 3</span>
              </th>
              <th style="width: 9%;">
                Recommended Mode of<br>Procurement<br>
                <span class="column-label">Column 4</span>
              </th>
              <th style="width: 6%;">
                Pre-<br>Procurement<br>Conference, if<br>applicable<br>(Yes/No)<br>
                <span class="column-label">Column 5</span>
              </th>
              <th style="width: 7%;">
                Start of<br>Procurement<br>Activity<br>
                <span class="column-label">Column 6</span>
              </th>
              <th style="width: 7%;">
                End of<br>Procurement<br>Activity<br>
                <span class="column-label">Column 7</span>
              </th>
              <th style="width: 8%;">
                Expected<br>Delivery/<br>Implementation<br>Period<br>
                <span class="column-label">Column 8</span>
              </th>
              <th style="width: 8%;">
                Source of Funds<br>
                <span class="column-label">Column 9</span>
              </th>
              <th style="width: 9%;">
                Estimated Budget<br>/ Authorized<br>Budgetary<br>Allocation (PAP)<br>
                <span class="column-label">Column 10</span>
              </th>
              <th style="width: 6%;">
                ATTACHED<br>SUPPORTING<br>DOCUMENTS</br>
                <span class="column-label">Column 11</span>
              </th>
              <th style="width: 5%;">
                <br>REMARKS</br>
                <span class="column-label">Column 12</span>
              </th>
            </tr>
          </thead>
          <tbody id="tableBody">
            </tbody>
          <tfoot>
            <tr class="total-row">
              <td colspan="8" style="text-align: right; padding-right: 1rem; font-weight: bold;">TOTAL BUDGET:</td>
              <td></td>
              <td id="totalBudget" style="font-weight: bold;">0.00</td>
              <td colspan="2"></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="signature-section">
        <div class="signature-box">
          <p class="signature-label">Prepared by:</p>
          <p class="signature-name">LCDR KARL LOU A TORIBIO PN</p>
          <p class="signature-title">AC of S for Logistics, S4 HPN & HSG</p>
          <p style="margin-top: 1.5rem; font-style: italic; font-size: 0.75rem;">
            Signature over Printed Name<br>
            Position/Designation
          </p>
          <p style="margin-top: 0.5rem; font-style: italic; font-size: 0.75rem;">HPN & HSG</p>
        </div>

        <div class="signature-box">
          <p class="signature-label">Submitted by:</p>
          <p class="signature-name">CAPT OLIVER B REFORBA PN</p>
          <p class="signature-title">Commander, HPN & HSG</p>
          <p style="margin-top: 1.5rem; font-style: italic; font-size: 0.75rem;">
            Signature over Printed Name<br>
            Position/Designation
          </p>
          <p style="margin-top: 0.5rem; font-style: italic; font-size: 0.75rem;">HPN & HSG</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const tbody = document.getElementById('tableBody');

// NEW: Function to toggle full screen mode
function toggleFullScreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
    });
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    }
  }
}

function addRow() {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true" oninput="updateTotal()"></td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  `;
  tbody.appendChild(tr);
  saveData();
}

function initRows() {
  if (tbody.querySelectorAll('tr').length === 0) {
    for (let i = 0; i < 5; i++) {
      addRow();
    }
  }
}

function updateTotal() {
  let total = 0;
  tbody.querySelectorAll('tr').forEach(row => {
    const budgetCell = row.cells[9];
    if (budgetCell) {
      const value = parseFloat(budgetCell.textContent.replace(/,/g, '')) || 0;
      total += value;
    }
  });
  document.getElementById('totalBudget').textContent = total.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
  saveData();
}

function loadFromUPR() {
  const rawData = sessionStorage.getItem("UPR_DATA");
  
  if (!rawData) {
    alert('‚ö†Ô∏è No UPR data found. Please create a UPR first.');
    return;
  }

  let data;
  try { 
    data = JSON.parse(rawData); 
  } catch(e) { 
    alert('‚ùå Invalid UPR data format.');
    return; 
  }

  const items = data.items || [];
  
  if (items.length === 0) {
    alert('‚ö†Ô∏è UPR has no items to import.');
    return;
  }

  tbody.innerHTML = "";

  items.forEach(item => {
    const description = item.desc || "";
    const qty = parseFloat(item.qty) || 0;
    const unit = item.unit || "";
    const unitCost = parseFloat(item.price) || 0;
    const total = qty * unitCost;
    const mode = data.modeProc || "";

    if (!description && !qty && !unit && !unitCost) return;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td contenteditable="true">${description}</td>
      <td contenteditable="true">Goods</td>
      <td contenteditable="true">${qty} ${unit}</td>
      <td contenteditable="true">${mode}</td>
      <td contenteditable="true">No</td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true" oninput="updateTotal()">${total.toFixed(2)}</td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
    `;
    
    tbody.appendChild(tr);
  });

  updateTotal();
  alert(`‚úÖ Successfully loaded ${items.length} items from UPR!`);
}

function saveData() {
  const rows = Array.from(tbody.querySelectorAll('tr')).map(row => {
    return Array.from(row.cells).map(cell => cell.textContent);
  });

  const data = {
    fiscalYear: document.getElementById('fiscalYear').value,
    endUser: document.getElementById('endUser').value,
    rows
  };

  sessionStorage.setItem('APP_DATA', JSON.stringify(data));
}

function loadData() {
  const saved = sessionStorage.getItem('APP_DATA');
  if (!saved) {
    initRows();
    return;
  }

  const data = JSON.parse(saved);
  
  if (data.fiscalYear) document.getElementById('fiscalYear').value = data.fiscalYear;
  if (data.endUser) document.getElementById('endUser').value = data.endUser;

  tbody.innerHTML = '';
  (data.rows || []).forEach((rowData) => {
    const tr = document.createElement('tr');
    rowData.forEach((cellData, index) => {
      const td = document.createElement('td');
      td.contentEditable = 'true';
      td.textContent = cellData;
      if (index === 9) {
        td.setAttribute('oninput', 'updateTotal()');
      }
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  updateTotal();
}

function clearForm() {
  if (confirm('Are you sure you want to clear all data?')) {
    sessionStorage.removeItem('APP_DATA');
    tbody.innerHTML = '';
    document.getElementById('fiscalYear').value = '';
    document.getElementById('endUser').value = '';
    document.getElementById('totalBudget').textContent = '0.00';
    initRows();
  }
}

document.addEventListener('input', saveData);
window.addEventListener('DOMContentLoaded', loadData);

initRows();
</script>

</body>
</html>